import{a as q}from"./chunk-VZQLDR2C.js";import{a as R,b as L}from"./chunk-WWOXZNFR.js";import{a as B}from"./chunk-L7GBDS54.js";import{A as h,G as b,H as r,I as y,Ka as A,M as x,O as m,R as j,S as i,T as a,U as c,V as w,W as M,X as p,a as T,aa as s,b as z,ba as _,ca as v,da as V,i as O,k as I,l as E,n as P,s as U,ua as W,v as D,va as N,w as F,ya as $,z as u}from"./chunk-5OIP4QEW.js";function K(o,t){o&1&&(i(0,"div",10),c(1,"div",11),i(2,"p"),s(3,"Loading comments..."),a()())}function Y(o,t){if(o&1){let e=w();i(0,"div",12),c(1,"i",13),i(2,"p"),s(3),a(),i(4,"button",14),M("click",function(){u(e);let l=p();return h(l.loadAllComments())}),s(5,"Try Again"),a()()}if(o&2){let e=p();r(3),_(e.error)}}function H(o,t){o&1&&(i(0,"div",18),c(1,"i",19),i(2,"h3"),s(3,"No Comments Found"),a(),i(4,"p"),s(5,"No comments have been posted yet."),a()())}function Q(o,t){if(o&1&&(i(0,"small"),s(1),a()),o&2){let e=p().$implicit,n=p(2);r(),_(n.getProjectLocation(e))}}function X(o,t){if(o&1&&(i(0,"div",48),c(1,"img",49),i(2,"div",50),c(3,"i",51),i(4,"span"),s(5,"Image not available"),a()(),i(6,"div",52),c(7,"i",53),a()()),o&2){let e=p().$implicit,n=p(4);r(),m("src",n.getMediaUrl(e.file_path),b)("alt",e.file_name)}}function Z(o,t){if(o&1&&(i(0,"div",54),c(1,"video",55),i(2,"div",50),c(3,"i",56),i(4,"span"),s(5,"Video not available"),a()(),i(6,"div",52),c(7,"i",57),a()()),o&2){let e=p().$implicit,n=p(4);r(),m("src",n.getMediaUrl(e.file_path),b)}}function ee(o,t){o&1&&(i(0,"div",58)(1,"div",59),c(2,"i",60),a(),i(3,"div",52),c(4,"i",61),a()())}function te(o,t){if(o&1){let e=w();i(0,"div",41),M("click",function(){let l=u(e).$implicit,d=p(4);return h(d.openMediaModal(l))}),x(1,X,8,2,"div",42)(2,Z,8,1,"div",43)(3,ee,5,0,"div",44),i(4,"div",45)(5,"span",46),s(6),a(),i(7,"span",47),s(8),a()()()}if(o&2){let e=t.$implicit,n=p(4);r(),m("ngIf",n.isImage(e.file_type)),r(),m("ngIf",n.isVideo(e.file_type)),r(),m("ngIf",!n.isImage(e.file_type)&&!n.isVideo(e.file_type)),r(2),m("title",e.file_name),r(),_(e.file_name),r(2),_(n.getFileSize(e.file_size))}}function ne(o,t){if(o&1&&(i(0,"div",37)(1,"h5"),c(2,"i",38),s(3),a(),i(4,"div",39),x(5,te,9,6,"div",40),a()()),o&2){let e=p().$implicit;r(3),v(" Attachments (",e.media_files.length,")"),r(2),m("ngForOf",e.media_files)}}function ie(o,t){if(o&1&&(i(0,"div",20)(1,"div",21)(2,"div",22)(3,"div",23),s(4),a(),i(5,"div",24)(6,"h4"),s(7),a(),i(8,"span",25),s(9),a()()(),i(10,"div",26),c(11,"i",27),s(12),a()(),i(13,"div",28)(14,"div",29),c(15,"i",30),i(16,"div")(17,"strong"),s(18,"Project:"),a(),s(19),c(20,"br"),x(21,Q,2,1,"small",31),a()(),i(22,"div",32),c(23,"i",33),i(24,"div")(25,"strong"),s(26,"Task:"),a(),s(27),c(28,"br"),i(29,"small"),s(30,"Status: "),i(31,"span",34),s(32),a()()()()(),i(33,"div",35)(34,"p"),s(35),a()(),x(36,ne,6,2,"div",36),a()),o&2){let e=t.$implicit,n=p(2);r(4),v(" ",n.getUserEmail(e).charAt(0).toUpperCase()," "),r(3),_(n.getUserEmail(e)),r(),j(n.getRoleClass(n.getUserRole(e))),r(),v(" ",n.getUserRole(e)," "),r(3),v(" ",n.formatDate(e.created_at)," "),r(7),V(" ",n.getProjectCode(e)," - ",n.getStoreName(e)," "),r(2),m("ngIf",n.getProjectLocation(e)),r(6),v(" ",n.getTaskTitle(e)," "),r(4),j(n.getStatusClass(n.getTaskStatus(e))),r(),_(n.getTaskStatus(e)),r(3),_(e.comment_text),r(),m("ngIf",e.media_files&&e.media_files.length>0)}}function oe(o,t){if(o&1&&(i(0,"div",15),x(1,H,6,0,"div",16)(2,ie,37,15,"div",17),a()),o&2){let e=p();r(),m("ngIf",e.comments.length===0),r(),m("ngForOf",e.comments)}}function re(o,t){if(o&1&&c(0,"img",72),o&2){let e=p(2);m("src",e.getMediaUrl(e.selectedMedia.file_path),b)("alt",e.selectedMedia.file_name)}}function ae(o,t){if(o&1&&c(0,"video",73),o&2){let e=p(2);m("src",e.getMediaUrl(e.selectedMedia.file_path),b)}}function se(o,t){if(o&1){let e=w();i(0,"div",62),M("click",function(){u(e);let l=p();return h(l.closeMediaModal())}),i(1,"div",63),M("click",function(l){return u(e),h(l.stopPropagation())}),i(2,"div",64)(3,"h4"),s(4),a(),i(5,"button",65),M("click",function(){u(e);let l=p();return h(l.closeMediaModal())}),c(6,"i",66),a()(),i(7,"div",67),x(8,re,1,2,"img",68)(9,ae,1,1,"video",69),i(10,"div",70),c(11,"i",13),i(12,"p"),s(13,"Media file could not be loaded"),a()()(),i(14,"div",71)(15,"span"),s(16),a()()()()}if(o&2){let e=p();r(4),_(e.selectedMedia.file_name),r(4),m("ngIf",e.selectedMedia&&e.isImage(e.selectedMedia.file_type)),r(),m("ngIf",e.selectedMedia&&e.isVideo(e.selectedMedia.file_type)),r(7),_(e.getFileSize((e.selectedMedia==null?null:e.selectedMedia.file_size)||0))}}var S=class o{constructor(t,e,n,l){this.commentService=t;this.projectService=e;this.taskService=n;this.userService=l}comments=[];loading=!0;error="";selectedMedia=null;showMediaModal=!1;ngOnInit(){this.loadAllComments()}loadAllComments(){this.loading=!0,this.error="",this.taskService.getTasks().subscribe({next:t=>{let e=t.tasks||[];if(e.length===0){this.comments=[],this.loading=!1;return}let n=e.map(l=>this.commentService.getComments(l.id).pipe(P(d=>(console.error(`Error loading comments for task ${l.id}:`,d),O({comments:[]})))));E(n).subscribe({next:l=>{let d=[];if(l.forEach((f,k)=>{let g=e[k];f.comments&&Array.isArray(f.comments)&&f.comments.forEach(C=>{d.push(z(T({},C),{task:g,media_files:C.media_files||[]}))})}),d.length===0){this.comments=[],this.loading=!1;return}this.enrichCommentsWithDetails(d)},error:l=>{console.error("Error loading comments:",l),this.error="Failed to load comments",this.loading=!1}})},error:t=>{console.error("Error loading tasks:",t),this.error="Failed to load tasks",this.loading=!1}})}enrichCommentsWithDetails(t){let e=[...new Set(t.map(d=>d.task?.project_id).filter(Boolean))],n=[...new Set(t.map(d=>d.user_id))],l=[];if(e.forEach(d=>{l.push(this.projectService.getProject(d).pipe(I(f=>({type:"project",data:f.project})),P(f=>(console.error(`Error loading project ${d}:`,f),O({type:"project",data:null})))))}),n.forEach(d=>{l.push(this.userService.getUser(d).pipe(I(f=>({type:"user",data:f.user})),P(f=>(console.error(`Error loading user ${d}:`,f),O({type:"user",data:null})))))}),l.length===0){this.comments=this.sortComments(t),this.loading=!1;return}E(l).subscribe({next:d=>{let f=d.filter(g=>g.type==="project"&&g.data).map(g=>g.data),k=d.filter(g=>g.type==="user"&&g.data).map(g=>g.data);t.forEach(g=>{g.project=f.find(C=>C.id===g.task?.project_id),g.user=k.find(C=>C.id===g.user_id)}),this.comments=this.sortComments(t),this.loading=!1},error:d=>{console.error("Error enriching comments:",d),this.comments=this.sortComments(t),this.loading=!1}})}sortComments(t){return t.sort((e,n)=>new Date(n.created_at).getTime()-new Date(e.created_at).getTime())}openMediaModal(t){this.selectedMedia=t,this.showMediaModal=!0}closeMediaModal(){this.showMediaModal=!1,this.selectedMedia=null}isImage(t){return t?["jpg","jpeg","png","gif","webp"].includes(t.toLowerCase()):!1}isVideo(t){return t?["mp4","mov","avi","webm","mkv"].includes(t.toLowerCase()):!1}getMediaUrl(t){return t?`C:\\xampp\\htdocs\\uploads\\${t.split("/").pop()||t}`:""}formatDate(t){if(!t)return"Unknown Date";try{return new Date(t).toLocaleString()}catch{return"Invalid Date"}}getFileSize(t){if(!t||t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,l)).toFixed(2))+" "+n[l]}getRoleClass(t){return t?"role-"+t.toLowerCase().replace(/\s+/g,"-"):"role-unknown"}getStatusClass(t){return t?"status-"+t.toLowerCase().replace(/\s+/g,"-"):"status-unknown"}getUserEmail(t){return t.user?.email||t.user_email||"Unknown User"}getUserRole(t){return t.user?.role||"Unknown Role"}getProjectCode(t){return t.project?.project_code||"N/A"}getStoreName(t){return t.project?.store_name||"Unknown Store"}getProjectLocation(t){let e=t.project?.city||"",n=t.project?.state||"";return e&&n?`${e}, ${n}`:e||n||""}getTaskTitle(t){return t.task?.title||"Unknown Task"}getTaskStatus(t){return t.task?.status||"N/A"}static \u0275fac=function(e){return new(e||o)(y(q),y(R),y(L),y(B))};static \u0275cmp=D({type:o,selectors:[["app-comments"]],decls:12,vars:5,consts:[[1,"comments-container"],[1,"header"],[1,"title"],[1,"fas","fa-comments"],[1,"stats"],[1,"badge"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","comments-list",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"loading-container"],[1,"spinner"],[1,"error-container"],[1,"fas","fa-exclamation-triangle"],[1,"btn-retry",3,"click"],[1,"comments-list"],["class","empty-state",4,"ngIf"],["class","comment-card",4,"ngFor","ngForOf"],[1,"empty-state"],[1,"fas","fa-comment-slash"],[1,"comment-card"],[1,"comment-header"],[1,"user-info"],[1,"avatar"],[1,"user-details"],[1,"role-badge"],[1,"timestamp"],[1,"fas","fa-clock"],[1,"context-info"],[1,"project-info"],[1,"fas","fa-folder"],[4,"ngIf"],[1,"task-info"],[1,"fas","fa-tasks"],[1,"status-badge"],[1,"comment-content"],["class","media-section",4,"ngIf"],[1,"media-section"],[1,"fas","fa-paperclip"],[1,"media-grid"],["class","media-item",3,"click",4,"ngFor","ngForOf"],[1,"media-item",3,"click"],["class","media-preview image-preview",4,"ngIf"],["class","media-preview video-preview",4,"ngIf"],["class","media-preview file-preview",4,"ngIf"],[1,"media-info"],[1,"file-name",3,"title"],[1,"file-size"],[1,"media-preview","image-preview"],["onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",3,"src","alt"],[1,"media-placeholder",2,"display","none"],[1,"fas","fa-image"],[1,"media-overlay"],[1,"fas","fa-search-plus"],[1,"media-preview","video-preview"],["preload","metadata","onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",3,"src"],[1,"fas","fa-video"],[1,"fas","fa-play"],[1,"media-preview","file-preview"],[1,"file-icon"],[1,"fas","fa-file"],[1,"fas","fa-download"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],["class","modal-image","onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",3,"src","alt",4,"ngIf"],["controls","","class","modal-video","onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",3,"src",4,"ngIf"],[1,"media-error",2,"display","none"],[1,"modal-footer"],["onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",1,"modal-image",3,"src","alt"],["controls","","onerror","this.style.display='none'; this.nextElementSibling.style.display='flex';",1,"modal-video",3,"src"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"i",3),s(4," All Comments "),a(),i(5,"div",4)(6,"span",5),s(7),a()()(),x(8,K,4,0,"div",6)(9,Y,6,1,"div",7)(10,oe,3,2,"div",8),a(),x(11,se,17,4,"div",9)),e&2&&(r(7),v("",n.comments.length," Total Comments"),r(),m("ngIf",n.loading),r(),m("ngIf",n.error&&!n.loading),r(),m("ngIf",!n.loading&&!n.error),r(),m("ngIf",n.showMediaModal&&n.selectedMedia))},dependencies:[W,N],styles:[".comments-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:15px;border-bottom:2px solid #e1e5e9}.title[_ngcontent-%COMP%]{color:#2c3e50;margin:0;font-size:28px;font-weight:600}.title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:12px;color:#3498db}.stats[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:8px 16px;border-radius:20px;font-size:14px;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:#6c757d}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#dc3545}.error-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;margin-bottom:20px}.btn-retry[_ngcontent-%COMP%]{background:#3498db;color:#fff;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:14px;margin-top:15px;transition:background .3s ease}.btn-retry[_ngcontent-%COMP%]:hover{background:#2980b9}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:80px 20px;color:#6c757d}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:64px;margin-bottom:20px;opacity:.5}.comments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.comment-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #00000014;padding:24px;border:1px solid #e1e5e9;transition:transform .2s ease,box-shadow .2s ease}.comment-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 20px #0000001f}.comment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.avatar[_ngcontent-%COMP%]{width:48px;height:48px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px}.user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;color:#2c3e50;font-size:16px;font-weight:600}.role-badge[_ngcontent-%COMP%]{font-size:12px;padding:4px 8px;border-radius:12px;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.role-admin[_ngcontent-%COMP%], .role-super-admin[_ngcontent-%COMP%]{background:#ff6b6b;color:#fff}.role-editor[_ngcontent-%COMP%]{background:#4ecdc4;color:#fff}.role-normal-user[_ngcontent-%COMP%]{background:#95e1d3;color:#2c3e50}.role-associate[_ngcontent-%COMP%], .role-ground-team[_ngcontent-%COMP%]{background:#feca57;color:#2c3e50}.timestamp[_ngcontent-%COMP%]{color:#6c757d;font-size:14px;display:flex;align-items:center;gap:6px}.context-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px;padding:16px;background:#f8f9fa;border-radius:8px;border-left:4px solid #3498db}.project-info[_ngcontent-%COMP%], .task-info[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:10px}.project-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .task-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3498db;margin-top:4px;font-size:16px}.project-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .task-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1}.project-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .task-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2c3e50;font-size:14px}.project-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], .task-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6c757d;font-size:12px}.status-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 8px;border-radius:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.status-to-do[_ngcontent-%COMP%]{background:#e9ecef;color:#6c757d}.status-in-progress[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-completed[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-on-hold[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.comment-content[_ngcontent-%COMP%]{margin-bottom:20px}.comment-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;line-height:1.6;color:#495057;font-size:15px}.media-section[_ngcontent-%COMP%]{border-top:1px solid #e1e5e9;padding-top:16px}.media-section[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 12px;color:#495057;font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px}.media-section[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#6c757d}.media-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.media-item[_ngcontent-%COMP%]{cursor:pointer;border-radius:8px;overflow:hidden;border:1px solid #e1e5e9;transition:transform .2s ease,box-shadow .2s ease}.media-item[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 4px 12px #00000026}.media-preview[_ngcontent-%COMP%]{position:relative;height:120px;overflow:hidden}.media-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .media-preview[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.media-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.media-item[_ngcontent-%COMP%]:hover   .media-overlay[_ngcontent-%COMP%]{opacity:1}.media-overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff;font-size:24px}.media-info[_ngcontent-%COMP%]{padding:8px 12px;background:#fff;display:flex;flex-direction:column;gap:2px}.file-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#2c3e50;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-size[_ngcontent-%COMP%]{font-size:11px;color:#6c757d}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;max-width:90vw;max-height:90vh;overflow:hidden;box-shadow:0 20px 60px #0000004d}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid #e1e5e9;background:#f8f9fa}.modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:18px;font-weight:600}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;color:#6c757d;cursor:pointer;padding:8px;border-radius:50%;transition:background .3s ease,color .3s ease}.close-btn[_ngcontent-%COMP%]:hover{background:#e9ecef;color:#495057}.modal-body[_ngcontent-%COMP%]{padding:24px;display:flex;align-items:center;justify-content:center;min-height:300px}.modal-image[_ngcontent-%COMP%]{max-width:100%;max-height:70vh;object-fit:contain;border-radius:8px}.modal-video[_ngcontent-%COMP%]{max-width:100%;max-height:70vh;border-radius:8px}.modal-footer[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e1e5e9;background:#f8f9fa;text-align:center;color:#6c757d;font-size:14px}@media (max-width: 768px){.comments-container[_ngcontent-%COMP%]{padding:15px}.header[_ngcontent-%COMP%]{flex-direction:column;gap:15px;text-align:center}.context-info[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:15px}.comment-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.media-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.modal-content[_ngcontent-%COMP%]{margin:10px;max-width:calc(100vw - 20px);max-height:calc(100vh - 20px)}}"]})};var le=[{path:"",component:S}],G=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=F({type:o});static \u0275inj=U({imports:[$,A.forChild(le)]})};export{G as CommentsModule};
